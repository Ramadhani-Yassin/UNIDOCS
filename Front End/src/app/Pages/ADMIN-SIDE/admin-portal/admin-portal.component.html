<!-- CONTENT -->
<app-admin-nav></app-admin-nav>
<section id="content" [class.sidebar-collapsed]="!(sidebarService.isOpen$ | async)">
  <!-- MAIN -->
  <main>
    <div class="head-title">
      <div class="left">
        <h1>Admin Dashboard</h1>
        <ul class="breadcrumb">
          <li>
            <a href="#" style="text-decoration: none;">Dashboard</a>
          </li>
          <li><i class="bx bx-chevron-right"></i></li>
          <li>
            <a class="active" href="#" style="text-decoration: none;">Home</a>
          </li>
        </ul>
      </div>
    </div>

    <ul class="box-info">
      <li>
        <i class="bx bxs-check-circle"></i>
        <span class="text">
          <h3>505</h3>
          <p>Letters Generated</p>
        </span>
      </li>
      <li>
        <i class="bx bxs-file"></i>
        <span class="text">
          <h3>8</h3>
          <p>Letter Templates</p>
        </span>
      </li>
      <li>
        <i class="bx bxs-user"></i>
        <span class="text">
          <h3>5658</h3>
          <p>Registered Students</p>
        </span>
      </li>
    </ul>

    <div class="table-data">
      <div class="order">
        <div class="head">
          <h3>Recent Letters Generated</h3>
          <i class="bx bx-search"></i>
          <i class="bx bx-filter"></i>
        </div>
        <table>
          <thead>
            <tr>
              <th>Student</th>
              <th>Letter Type</th>
              <!--<th>Request Date</th>-->
              <th>Status</th>
              <th>Admin Comment</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <!-- Show only the top 20 requests -->
            <tr *ngFor="let request of letterRequests | slice:0:20; let i = index">
              <td>{{ request.fullName }}</td>
              <td>{{ request.letterType }}</td>
              <!--<td>{{ formatDate(request.requestDate) }}</td>-->
              <td class="status-cell" style="min-width: 160px;">
                <!-- Show badge if not editing -->
                <span
                  *ngIf="editingStatusIndex !== i"
                  class="status-badge"
                  [ngClass]="{
                    'pending': request.status === 'PENDING',
                    'approved': request.status === 'APPROVED',
                    'declined': request.status === 'DECLINED'
                  }"
                  (click)="setEditingStatus(i)"
                  style="cursor:pointer"
                  title="Click to change status"
                >
                  {{ request.status | titlecase }}
                </span>
                <!-- Show dropdown if editing -->
                <select
                  *ngIf="editingStatusIndex === i"
                  [(ngModel)]="request.status"
                  (blur)="saveStatus(request, i)"
                  (change)="saveStatus(request, i)"
                  autofocus
                >
                  <option *ngFor="let s of statuses" [value]="s">{{ s | titlecase }}</option>
                </select>
              </td>
              <td>
                <input [(ngModel)]="request.adminComment" placeholder="Add comment" />
              </td>
              <td>
                <button (click)="updateStatus(request)">Update</button>
              </td>
            </tr>
          </tbody>
        </table>

      </div>
<!--
      <div class="todo">
        <div class="head">
          <h3>Admin Tasks</h3>
          <i class="bx bx-plus"></i>
          <i class="bx bx-filter"></i>
        </div>
        <ul class="todo-list">
          <li class="not-completed">
            <p>Review Requesting Trends</p>
            <i class="bx bx-dots-vertical-rounded"></i>
          </li>
          <li class="completed">
            <p>Students Management</p>
            <i class="bx bx-dots-vertical-rounded"></i>
          </li>
          <li class="not-completed">
            <p>Publish Announcements</p>
            <i class="bx bx-dots-vertical-rounded"></i>
          </li>
        </ul>
      </div>
-->
    </div>
  </main>
  <!-- MAIN -->
</section>
<!-- CONTENT -->